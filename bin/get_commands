#!/usr/bin/env bash

# Remove lines starting with # and all empty lines
result=$(cat ~/commands.txt ~/custom_commands.txt | grep -v -E '^#|^\s*$' | peco)

if [ "$result" = '' ]; then
    exit 1
fi

# to test
#result="\`# Recreated single service #\` echo \"Service name: \"; \`# another comment \` read service && docker-compose stop \$service; docker-compose rm -f \$service; docker-compose up -d \$service # comment here"

# remove comment end of the line
result=$(sed -r 's/[^`]#[^`][^''";]+$//g' <<< $result)
# remove inline comments
result=$(sed -r 's/`#[^`]*`//g' <<< $result)

display_time=$(tmux show-options -g display-time | grep -o '[0-9]*')

tmux set-option -g display-time 1
tmux display-message
tmux set-option -g display-time $display_time

export TMUX_WINDOW=$(tmux show-messages | tail -1 | grep -o 'current pane \([0-9]\)' | grep -o '[0-9]*')

tmux send-keys -t "$TMUX_WINDOW" "$result"