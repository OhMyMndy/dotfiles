#!/usr/bin/env bash

echo "Docker build"

docker build -t arch-applications:0.1 ~/dotfiles/dockerFiles/arch_applications
result=$?

if [ $result -ne 0 ]; then
  echo "Docker build exited with status $result"
  # exit $result
fi
XSOCK=/tmp/.X11-unix
XAUTH=/tmp/.docker.xauth

xauth nlist $DISPLAY | sed -e 's/^..../ffff/' | xauth -f $XAUTH nmerge -

echo "Executing $@" | tee -a /tmp/arch-application.log

docker run -ti --rm -e DISPLAY=$DISPLAY -v $XSOCK:$XSOCK -v $XAUTH:$XAUTH -e XAUTHORITY=$XAUTH --privileged --cap-add=ALL -v /lib/modules:/lib/modules:ro -v /dev:/dev -v $HOME -v $HOME:/home/developer arch-applications:0.1 $@
echo "$@ exited with status $?" | tee -a /tmp/arch-application.log
