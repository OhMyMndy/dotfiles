#!/usr/bin/env bash

timeout=$1
source=$2

if [ "$1" == "" ];
then
    echo "No timeout provided"
    exit 1
fi


if [ "$2" == "" ];
then
    echo "No source provided"
    exit 2
fi

command="nc -w $timeout -z $source 22"

if [ "$(which nc)" == "" ];
then
    command="ping -w $timeout $source 2>&1 >/dev/null"
fi
while true;
do
    eval $command 2>&1 >/dev/null
    return=$?
    if [ "$return" != "0" ];
    then
        echo "$(date) no connection to ${source}"
    fi
    sleep $timeout
done
